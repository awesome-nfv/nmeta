<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Nmeta : Extensible Traffic Classification on SDN">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="shortcut icon" href="images/favicon.ico"/>
    <title>Nmeta</title>
  </head>

  <body>

  <!-- NAVBAR -->
  <div id="header"></div>
  <div class="navbar-box">
    <div id="nav">
        <ul id="navbar">
          <li>Welcome</li>
          <li><a href="motivation.html">Motivation</a></li>
          <li><a href="install.html">Install</a></li>
          <li><a href="develop.html">Develop</a></li>
          <li><a href="faq.html">FAQ</a></li>
          <li><a href="extras.html">Extras</a></li>
        </ul>
    </div>
	<div id="navbreak">
	</div>
    <div id="nav2">
      <ul id="navbar2">
        <li><a href="index.html">Overview</a></li>
        <li><a href="quickstart.html">Quick Start</a></li>
        <li>User Guide</li>
        <li><a href="https://github.com/mattjhayes/nmeta" target="_blank">Github</a></li>
      </ul>
    </div>
    <div id="navbreak">
	</div>
  </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<h1>
  <a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  User Guide
</h1>

<h3>
  <a id="contents" class="anchor" href="#contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Contents:
</h3>
<p>
  <a href="#configure-nmeta-system">Configure Nmeta System Settings</a>
  <br>
  <a href="#main-policy-configuration">Configure Main Policy</a>
  <br>
  <a href="#use-the-api">Use the API</a>
  <br>
<h2>
  <a id="configure-nmeta-system" class="anchor" href="#configure-nmeta-system" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Configure the Nmeta System Settings
</h2>

<p>Configuration files are in the <em>config</em> subdirectory and are written
in YAML ("YAML Ain't Markup Language") format
(see: <a href="http://www.yaml.org/spec/1.2/spec.html" target="_blank">http://www.yaml.org/spec/1.2/spec.html</a>)</p>

<p>The general configuration parameters are stored in the file:</p>

<pre><code>~/nmeta/config/config.yaml
</code></pre>

<h2>
  <a id="main-policy-configuration" class="anchor" href="#main-policy-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Configure Main Policy
</h2>
<p>The main policy configures how nmeta works with data plane traffic. This includes traffic classification rules.
<p>The main policy is stored in the YAML file:</p>

<pre><code>~/nmeta/config/main_policy.yaml
</code></pre>

<p>It is used to control what classifiers are used, in what order and what actions are taken.</p>

<p>The traffic classification policy is based off a root key <em>tc_rules</em>. This root contains a <em>ruleset</em> name (only one ruleset supported at this stage), which in turn contains one or more <em>rules</em>.</p>

<p>Rules are an ordered list (denoted by preceding dash). Each rule contains:</p>

<ul>
  <li>A <em>comment</em> to describe the purpose of the rule (optional)</li>
  <li>A <em>match type</em></li>
  <li>A single <em>conditions_list</em> stanza that contains one or more <em>conditions</em> stanzas</li>
  <li>A single <em>actions</em> stanza</li>
</ul>

<p>Example simple traffic classification policy with a single rule:</p>

<pre><code><img src="images/userguide/simple_tc_policy.png" alt="simple traffic classification policy">
</code></pre>

<p>A <em>comment</em> must start with the attribute <em>comment:</em> and any single-line string can follow</p>

<p>A <em>match type</em> is one of <em>any</em> or <em>all</em></li>

<p>A <em>conditions_list</em> stanza contains:</p>

<ul>
  <li>A match type, consisting of <em>any</em> or <em>all</em></li>
  <li>One or more <em>conditions</em> as list items (denoted by dash preceding the first item)</li>
  <li>One or more <em>classifiers</em> (see below)</li>
</ul>

<p>A <em>conditions</em> stanza is a list item in a conditions list and contains:</p>

<ul>
  <li>A match type, consisting of <em>any</em> or <em>all</em></li>
  <li>One or more <em>classifiers</em> (see below)</li>
</ul>

<p>A <em>actions</em> stanza contains one or more attribute/value pairs</p>

<p>Here is a more complex traffic classification policy:</p>

<pre><code><img src="images/userguide/complex_tc_policy.png" alt="complex traffic classification policy">
</code></pre>

<p>Conditions invoke classifiers. There are four types of classifier supported:
<ul>
  <li>Static</li>
  <li>Identity</li>
  <li>Payload</li>
  <li>Statistical</li>
</ul>

<h3>
<a id="static-classifiers" class="anchor" href="#static-classifiers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Static Classifiers</h3>

<p>Static classifiers match on attributes in packet headers, or on environmental attributes</p>

<p>Supported attributes are:</p>
<table>
  <tr>
    <th>
      Name
    </th>
    <th>
      Description
    </th>
    <th>
      Example(s)
    </th>
  </tr>
  <tr>
    <td>
      eth_src
    </td>
    <td>
      Ethernet source MAC address
    </td>
    <td>
      eth_src: 08:00:27:4a:2d:41
    </td>
  </tr>
  <tr>
    <td>
      eth_dst
    </td>
    <td>
      Ethernet destination MAC address
    </td>
    <td>
      eth_dst: 08:00:27:4a:2d:42
    </td>
  </tr>
  <tr>
    <td>
      eth_type
    </td>
    <td>
      Ethernet type
      <br>
      Can be in hex (starting with 0x) or decimal
    </td>
    <td>
      eth_type: 0x0800
      <br>
      eth_type: 35020
    </td>
  </tr>
  <tr>
    <td>
      ip_src
    </td>
    <td>
      IP source address
      <br>
      Can be a single address, a network with a mask in CIDR notation, or an IP range with two addresses separated by a hyphen
      <br>
	  Both addresses in a
      range must be the same type, and the second address must be higher than the first
    </td>
    <td>
      ip_src: 192.168.56.12
      <br>
      ip_src: 192.168.56.0/24
      <br>
      ip_src: 192.168.56.12-192.168.56.31
    </td>
  </tr>
  <tr>
    <td>
      ip_dst
    </td>
    <td>
      IP destination address
      <br>
      Can be a single address, a network with a mask in CIDR notation, or an IP range with two addresses separated by a hyphen
      <br>
      Both addresses in a
      range must be the same type, and the second address must be higher than the first
    </td>
    <td>
      ip_dst: 192.168.57.40
      <br>
      ip_src: 192.168.57.0/24
      <br>
      ip_src: 192.168.57.36-192.168.78.31
    </td>
  </tr>
  <tr>
    <td>
      tcp_src
    </td>
    <td>
      TCP source address
    </td>
    <td>
      tcp_src: 22
    </td>
  </tr>
  <tr>
    <td>
      tcp_dst
    </td>
    <td>
      TCP destination address
    </td>
    <td>
      tcp_dst: 80
    </td>
  </tr>
</table>

<p>More attributes will be added over time.</p>

<h3>
  <a id="identity-classifiers" class="anchor" href="#identity-classifiers" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Identity Classifiers
</h3>

<p>All identity classifiers are prefixed with 'identity_'
  LLDP systemname may be matched as a regular expression
  The match pattern must be contained in single quotes
    Example:
    -------
    To match system names of *.audit.example.com add this policy condition:</p>

<pre><code>identity_lldp_systemname_re: '.*\.audit\.example\.com'
</code></pre>

<p>Supported attributes are:</p>
<table>
  <tr>
    <th>
      Name
    </th>
    <th>
      Description
    </th>
    <th>
      Example(s)
    </th>
  </tr>
  <tr>
    <td>
      identity_lldp_systemname
    </td>
    <td>
      Exact match against a system name discovered via LLDP
    </td>
    <td>
      identity_lldp_systemname: bob.example.com
    </td>
  </tr>
  <tr>
    <td>
      identity_lldp_systemname_re
    </td>
    <td>
      Regular expression match against a system name discovered via LLDP
    </td>
    <td>
      identity_lldp_systemname_re: '.*\.audit\.example\.com'
    </td>
  </tr>
  <tr>
    <td>
      identity_service_dns
    </td>
    <td>
      Exact match of either IP address in a flow against a DNS domain
    </td>
    <td>
      identity_service_dns: www.example.com
    </td>
  </tr>
  <tr>
    <td>
      identity_service_dns_re
    </td>
    <td>
      Regular expression match of either IP address in a flow against a DNS domain
    </td>
    <td>
      identity_service_dns_re: '.*\.example\.com'
    </td>
  </tr>
</table>


<h3>
<a id="statistical-classifiers" class="anchor" href="#statistical-classifiers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Statistical Classifiers</h3>

<p>All statistical classifiers are prefixed with 'statistical_'</p>

<p>TBD - more here</p>

<h3>
<a id="payload-classifiers" class="anchor" href="#payload-classifiers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Payload Classifiers</h3>

<p>TBD</p>

<h2>
<a id="qos-configuration" class="anchor" href="#qos-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>QoS Configuration</h2>

<p>Quality of Service (QoS) configuration parameters are stored in the file:</p>

<pre><code>qos_policy.yaml
</code></pre>

<h1>
<a id="use-the-api" class="anchor" href="#use-the-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use the API</h1>

<p>The nmeta API provides HTTP read access (no write at this stage) to data within nmeta. Data includes:
<ul>
  <li><em>Conversation Type Metadata</em>. The types of conversations that are occuring over the network
  <li><em>Participant Metadata</em>. Who/what is connected to the network
  <li><em>Performance Metrics</em>. How the system is performing
</ul>

<p>
  Here is a visualisation of the API hierarchy:
  <br>
  <img src="images/system/api_hierarchy.png" alt="API Hierarchy">
</p>

<p>
  To return the JSON in a human-friendly format, precede the API call with the <a href="misc.html#jsonpretty.py" target="_blank">jsonpretty.py</a> script
  (requires install of <a href="misc.html#jsonpretty.py" target="_blank">simplejson</a>):
</p>
<pre><code>sudo python ~/nmeta/misc/jsonpretty.py API_CALL_HERE
</code></pre>

<p>Example API Calls to run on local host (jsonpretty.py omitted for brevity):</p>

<h3>
<a id="conversation-type-metadata-api" class="anchor" href="#conversation-type-metadata-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conversation Type Metadata API Calls
</h3>

<p>Return the Flow Metadata Table:</p>

<pre><code>http://127.0.0.1:8080/nmeta/flowtable/
</code></pre>
<p>
  Returns the whole flow table - use with caution due to load considerations
</p>

<h3>
<a id="participant-metadata-api" class="anchor" href="#participant-metadata-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Participant Metadata API Calls
</h3>

<p>Return the Identity MAC structure:</p>

<pre><code>http://127.0.0.1:8080/nmeta/identity/mac/
</code></pre>

<p>Return the Identity IP structure:</p>

<pre><code>http://127.0.0.1:8080/nmeta/identity/ip/
</code></pre>

<p>Return the Identity Service structure:</p>

<pre><code>http://127.0.0.1:8080/nmeta/identity/service/
</code></pre>

<p>Return the Identity NIC Table (old - will be deprecated at some stage):</p>

<pre><code>http://127.0.0.1:8080/nmeta/identity/nictable/
</code></pre>

<p>Return the Identity System Table (old - will be deprecated at some stage):</p>

<pre><code>http://127.0.0.1:8080/nmeta/identity/systemtable/
</code></pre>

<h3>
<a id="performance-metric-api" class="anchor" href="#performance-metric-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance Metric API Calls
</h3>

<p>Return the Flow Metadata table size as number of rows:</p>

<pre>http://127.0.0.1:8080/nmeta/measurement/tablesize/rows/
</code></pre>

<p>Return the rate at which nmeta is processing events from switches, as events per second:</p>

<pre><code>http://127.0.0.1:8080/nmeta/measurement/eventrates/
</code></pre>

<p>Return statistics on nmeta per-packet processing time:</p>

<pre><code>http://127.0.0.1:8080/nmeta/measurement/metrics/packet_time/
</code></pre>

<h1>
  <a id="logging" class="anchor" href="#logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Logging
</h1>

<p>
  Logging is configured through the main policy is stored in the YAML file:
</p>

<pre><code>~/nmeta/config/main_policy.yaml
</code></pre>

<p>
  Logging is separately configured for syslog and to the console and levels are configurable per module. The log format is also customisable.
</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Nmeta maintained by <a href="https://github.com/mattjhayes" target="_blank">mattjhayes</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>



  </body>
</html>
